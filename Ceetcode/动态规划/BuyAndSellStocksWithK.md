本体使用动态规划，设 f[k,i] 表示使用在 [0,i] 天（左闭右闭）最多 k 次交易的最大利润。

在第 i 天，价格为 prices[i] ，我们此时可以忽略它，直接转移到状态 f[k,i-1]，因为一天之内不能完成买卖，或者可以在 i天卖了。如果我们在第 i 天卖了，那么就要在 j 天买，$j\in[ 0,i)$，在 j,i 之间其它的交易不发生。

我们在这次交易中赚到的利润为 prices[i]-prices[j]，那么在 j 之前，最多有 k-1 次交易发生。在这些交易中， j 应该被 excluded，因为我们在 j 买了股票。因为这时的利润是：prices[i]-prices[j] + f[k-1,j-1]。这里可以使用 f[k-1,j]，这样就不用担心 j-1<0的问题了。另外一个选项就是不进行这次交易。因此最终的状态转移方程为：
$$
f[k,i]=\max(f[k,i-1],prices[i]-prices[j]+f[k-1,j]),j\in[0,i)\\
=\max(f[k,i-1],prices[i]+max(f[k-1,j]-prices[j])),j\in[0,i)
$$
初始条件为：
$$
f[0,i]=0;\\
f[k,0]=0;
$$
第一个式子表示进行0次交易产生0的利润，第二个式子表示没有时间单无法交易。